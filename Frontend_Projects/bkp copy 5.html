<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Emoji Generator</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      display: flex;
      height: 100vh;
      overflow: hidden;
      background-color: #e0e0e0;
    }

    #output, #controls {
      padding: 20px;
      box-sizing: border-box;
      height: 100%;
    }

    #output {
      width: 50%;
      background: #fff;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      position: relative;
    }

    #controls {
      width: 50%;
      overflow-y: auto;
      background: #f5f5f5;
    }

    .emoji-stack {
      position: relative;
      width: 300px;
      height: 300px;
    }

    .emoji-bg {
      position: absolute;
      top: -8px;
      left: 0;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background-color: #ffeb3b;
      z-index: 0;
    }

    .emoji-stack img {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .emoji-text {
      position: absolute;
      width: 100%;
      text-align: center;
      font-size: 20px;
      font-weight: bold;
      text-shadow: 1px 1px 2px #000;
      color: white;
      pointer-events: none;
    }

    .emoji-text.top {
      top: -30px;
    }

    .emoji-text.bottom {
      bottom: -30px;
    }

    h2 {
      margin-top: 0;
    }

    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }

    input[type="text"], input[type="color"] {
      width: 100%;
      padding: 6px;
      margin-top: 4px;
      margin-bottom: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    input[type="range"] {
      width: 100%;
    }

    .horizontal-group {
      display: flex;
      gap: 10px;
    }

    .half-width {
      flex: 1;
    }

    .checkbox {
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <div id="output">
    <div class="emoji-stack" id="emojiDisplay">
      <div class="emoji-bg" id="emojiBg"></div>
      <img id="faceLayer" alt="Face">
      <img id="eyeLayer" alt="Eyes">
      <img id="mouthLayer" alt="Mouth">
      <div class="emoji-text top" id="topTextDisplay"></div>
      <div class="emoji-text bottom" id="bottomTextDisplay"></div>
    </div>
  </div>

  <div id="controls">
    <h2>Emoji Generator Controls</h2>

    <label>Emotion Preset:</label>
    <select id="preset" onchange="updateEmotionInputs(); randomize()">
      <option value="happy">ðŸ˜Š Happy</option>
      <option value="sad">ðŸ˜¢ Sad</option>
      <option value="angry">ðŸ˜  Angry</option>
      <option value="random">ðŸŽ° Random</option>
    </select>

    <label>Randomize Background Color:</label>
    <input type="checkbox" id="randomBg" checked>

    <label>Background Color:</label>
    <input type="color" id="bgColorPicker" value="#ffeb3b" onchange="updateBgColor()">

    <label>Face Randomness (%):</label>
    <input type="range" id="faceRandomness" min="0" max="100" value="30">
    <span id="faceRandVal">30%</span>

    <label>Eye Randomness (%):</label>
    <input type="range" id="eyeRandomness" min="0" max="100" value="30">
    <span id="eyeRandVal">30%</span>

    <label>Mouth Randomness (%):</label>
    <input type="range" id="mouthRandomness" min="0" max="100" value="30">
    <span id="mouthRandVal">30%</span>

    <label>Emotion Mix (Random Preset Only):</label>
    <div class="horizontal-group">
      <div class="half-width">
        Happy: <input type="range" id="happyMix" min="0" max="100" value="33">
      </div>
      <div class="half-width">
        Sad: <input type="range" id="sadMix" min="0" max="100" value="33">
      </div>
      <div class="half-width">
        Angry: <input type="range" id="angryMix" min="0" max="100" value="34">
      </div>
    </div>

    <div class="checkbox">
      <input type="checkbox" id="randomizeTextsSeparately">
      <label for="randomizeTextsSeparately">Randomize top/bottom text separately (only in random)</label>
    </div>

    <h3>Top Text Inputs</h3>
    <label>Happy Top Text</label>
    <input type="text" id="happyTopText" value="Yay!">

    <label>Sad Top Text</label>
    <input type="text" id="sadTopText" value="Oh no...">

    <label>Angry Top Text</label>
    <input type="text" id="angryTopText" value="Grrr!">

    <h3>Bottom Text Inputs</h3>
    <label>Happy Bottom Text</label>
    <input type="text" id="happyBottomText" value="So cheerful!">

    <label>Sad Bottom Text</label>
    <input type="text" id="sadBottomText" value="I'm upset...">

    <label>Angry Bottom Text</label>
    <input type="text" id="angryBottomText" value="Back off!">

    <button onclick="randomize()">ðŸŽ² Randomize Emoji</button>
  </div>

  <script>
    const maxOptions = {
      face: { happy: 5, sad: 5, angry: 5 },
      eye: { happy: 5, sad: 5, angry: 5 },
      mouth: { happy: 5, sad: 5, angry: 5 }
    };

    function getRandomInt(max) {
      return Math.floor(Math.random() * max) + 1;
    }

    function weightedRandom(prob, max) {
      return Math.random() * 100 < prob ? 1 : getRandomInt(max - 1) + 1;
    }

    function updateSliderValues() {
      document.getElementById("faceRandVal").textContent = document.getElementById("faceRandomness").value + "%";
      document.getElementById("eyeRandVal").textContent = document.getElementById("eyeRandomness").value + "%";
      document.getElementById("mouthRandVal").textContent = document.getElementById("mouthRandomness").value + "%";
    }

    function updateBgColor() {
      const color = document.getElementById("bgColorPicker").value;
      document.getElementById("emojiBg").style.backgroundColor = color;
    }

    function getEmotionFromMix() {
      const total = ['happyMix', 'sadMix', 'angryMix']
        .map(id => parseInt(document.getElementById(id).value, 10))
        .reduce((a, b) => a + b, 0);
      const r = Math.random() * total;
      if (r < document.getElementById("happyMix").value) return "happy";
      if (r < parseInt(document.getElementById("happyMix").value) + parseInt(document.getElementById("sadMix").value)) return "sad";
      return "angry";
    }

    function getLayerImage(type, emotion, randomnessId) {
      const prob = parseInt(document.getElementById(randomnessId).value, 10);
      const max = maxOptions[type][emotion];
      const choice = weightedRandom(prob, max);
      return `${type}/${emotion}/${choice}.png`;
    }

    function randomize() {
      const preset = document.getElementById("preset").value;
      const useRandomBg = document.getElementById("randomBg").checked;
      if (useRandomBg) {
        const randColor = '#' + Math.floor(Math.random() * 16777215).toString(16);
        document.getElementById("bgColorPicker").value = randColor;
        updateBgColor();
      }

      const getEmotion = () => preset === "random" ? getEmotionFromMix() : preset;

      const faceEmotion = getEmotion();
      const eyeEmotion = getEmotion();
      const mouthEmotion = getEmotion();

      document.getElementById("faceLayer").src = getLayerImage("face", faceEmotion, "faceRandomness");
      document.getElementById("eyeLayer").src = getLayerImage("eye", eyeEmotion, "eyeRandomness");
      document.getElementById("mouthLayer").src = getLayerImage("mouth", mouthEmotion, "mouthRandomness");

      const topText = getEmotionText(preset, "Top");
      const bottomText = getEmotionText(preset, "Bottom");

      document.getElementById("topTextDisplay").textContent = topText;
      document.getElementById("bottomTextDisplay").textContent = bottomText;
    }

    function getEmotionText(preset, position) {
      const separate = document.getElementById("randomizeTextsSeparately").checked;
      const emotion = preset === "random" ? getEmotionFromMix() : preset;
      const fieldId = emotion + position + "Text";
      const value = document.getElementById(fieldId).value;

      if (preset !== "random" || !separate) return value;

      const randomEmotion = getEmotionFromMix();
      const randFieldId = randomEmotion + position + "Text";
      return document.getElementById(randFieldId).value;
    }

    function updateEmotionInputs() {
      const preset = document.getElementById("preset").value;
      const showEmotionMix = preset === "random";
      document.getElementById("happyMix").parentElement.style.display = showEmotionMix ? "block" : "none";
      document.getElementById("sadMix").parentElement.style.display = showEmotionMix ? "block" : "none";
      document.getElementById("angryMix").parentElement.style.display = showEmotionMix ? "block" : "none";
      document.getElementById("randomizeTextsSeparately").parentElement.style.display = showEmotionMix ? "block" : "none";
    }

    // Initialize
    updateSliderValues();
    updateBgColor();
    updateEmotionInputs();
    randomize();

    document.getElementById("faceRandomness").oninput = updateSliderValues;
    document.getElementById("eyeRandomness").oninput = updateSliderValues;
    document.getElementById("mouthRandomness").oninput = updateSliderValues;
  </script>

</body>
</html>
